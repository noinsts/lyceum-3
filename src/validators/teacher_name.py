from typing import Tuple, Optional
import re

from src.db.connector import DBConnector

#: –ü–∞—Ç–µ—Ä–Ω –¥–ª—è –ø–æ–≤–Ω–æ–≥–æ –ü–Ü–ë –≤—á–∏—Ç–µ–ª—è: –ü—Ä—ñ–∑–≤–∏—â–µ –Ü–º º—è –ü–æ –±–∞—Ç—å–∫–æ–≤—ñ.
#: –î–æ–∑–≤–æ–ª—è—î —É–∫—Ä–∞—ó–Ω—Å—å–∫—ñ –ª—ñ—Ç–µ—Ä–∏, –∞–ø–æ—Å—Ç—Ä–æ—Ñ–∏, –¥–µ—Ñ—ñ—Å–∏.
TEACHER_NAME_PATTERN = re.compile(
    r"^([–ê-–Ø–Ü–á–Ñ–∞-—è—ñ—ó—î'`\-]+)\s+([–ê-–Ø–Ü–á–Ñ–∞-—è—ñ—ó—î'`\-]+)\s+([–ê-–Ø–Ü–á–Ñ–∞-—è—ñ—ó—î'`\-]+)$"
)
"""
TEACHER_NAME_PATTERN:
–ú–∞—Ç—á–∏—Ç—å –ø–æ–≤–Ω–µ —ñ–º‚Äô—è –≤—á–∏—Ç–µ–ª—è: "–ü—Ä—ñ–∑–≤–∏—â–µ –Ü–º‚Äô—è –ü–æ –±–∞—Ç—å–∫–æ–≤—ñ".
- –ö–æ–∂–Ω–∞ —á–∞—Å—Ç–∏–Ω–∞ –º–æ–∂–µ –º–∞—Ç–∏ –∞–ø–æ—Å—Ç—Ä–æ—Ñ ( º), –∑–≤–æ—Ä–æ—Ç–Ω–∏–π –∞–ø–æ—Å—Ç—Ä–æ—Ñ (`) –∞–±–æ –¥–µ—Ñ—ñ—Å (-).
- –ú–∞—î –±—É—Ç–∏ —Ä—ñ–≤–Ω–æ 3 —Å–ª–æ–≤–∞, —Ä–æ–∑–¥—ñ–ª–µ–Ω—ñ –ø—Ä–æ–±—ñ–ª–∞–º–∏.
–ù–∞–ø—Ä–∏–∫–ª–∞–¥: "–Ü–≤–∞–Ω–µ–Ω–∫–æ –û–ª–µ–≥ –ü–µ—Ç—Ä–æ–≤–∏—á", "–î–æ–Ω—á–µ–Ω–∫–æ-–ì–Ω–∞—Ç—é–∫ –Ü–≤–∞–Ω-–ü–µ—Ç—Ä–æ –Ü–≤–∞–Ω–æ–≤–∏—á"
"""


async def validate_teacher_name(teacher_name: str, db: DBConnector) -> Tuple[bool, Optional[str]]:
    """
    –í–∞–ª—ñ–¥—É—î —ñ–º'—è –≤—á–∏—Ç–µ–ª—è, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ (–Ü–≤–∞–Ω–æ–≤ –Ü–≤–∞–Ω –Ü–≤–∞–Ω–æ–≤–∏—á)

    Args:
        teacher_name (str): —ñ–º'—è –≤—á–∏—Ç–µ–ª—è
        db (DBConnector): –±–¥ –∑ —è–∫–æ—ó –±—É–¥–µ –≤–µ—Å—Ç–∏—Å—å –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –≤—á–∏—Ç–µ–ª—è

    Returns:
        Tuple:
            bool: —á–∏ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞
            reason: –ø—Ä–∏–º—ñ—Ç–∫–∏, —â–æ–¥–æ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó
    """

    if len(teacher_name) < 3:
        return False, "–î–æ–≤–∂–∏–Ω–∞ —ñ–º–µ–Ω—ñ –º–∞—î –±—É—Ç–∏ –±—ñ–ª—å—à–µ 3 —Å–∏–º–≤–æ–ª—ñ–≤"

    if len(teacher_name) > 50:
        return False, "–î–æ–≤–∂–∏–Ω–∞ —ñ–º–µ–Ω—ñ –º–∞—î –±—É—Ç–∏ –º–µ–Ω—à–µ 50 —Å–∏–º–≤–æ–ª—ñ–≤"

    match = TEACHER_NAME_PATTERN.match(teacher_name.strip())

    if not isinstance(teacher_name, str) or not match:
        return False, "–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ñ–æ—Ä–º–∞—Ç \"–ü—Ä—ñ–∑–≤–∏—â–µ —ñ–º'—è –ø–æ-–±–∞—Ç—å–∫–æ–≤—ñ\""

    if not await db.register.teacher_is_exists(teacher_name):
        return False, (
            "üö´ –¢–∞–∫–æ–≥–æ –ü–Ü–ü –Ω–µ–º–∞—î –≤ –Ω–∞—à–æ–º—É —Å–ø–∏—Å–∫—É –≤—á–∏—Ç–µ–ª—ñ–≤. "
            "–ú–æ–∂–ª–∏–≤–æ, –≤–∏ –≤–≤–µ–ª–∏ –∑ –ø–æ–º–∏–ª–∫–æ—é –∞–±–æ —â–µ –Ω–µ –¥–æ–¥–∞–Ω—ñ –¥–æ –±–∞–∑–∏.\n"
            "–°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑ –∞–±–æ –∑–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ @noinsts üë®‚Äçüíª"
        )

    return True, ""
